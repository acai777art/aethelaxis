<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Aethel Axis ‚Äì Maritime Assistant</title>

<meta name="theme-color" content="#0B1220" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}html,body{margin:0;height:100%;font-family:Inter,system-ui,sans-serif;background:#000;color:#fff}
/* background */
.bg{position:fixed;inset:0;z-index:-1;background:url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e")center/cover no-repeat}
.bg::after{content:"";position:absolute;inset:0;background:linear-gradient(to bottom,rgba(10,18,32,.8),rgba(10,18,32,.95))}
/* app container */
.app{height:100%;display:flex;flex-direction:column}
/* screens */
.screen{flex:1;display:none;padding:24px}
.screen.active{display:block}
.center{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}
/* branding */
.logo{width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,#3b82f6,#06b6d4);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:600;margin-bottom:20px}
.title{font-size:26px;font-weight:600}.tagline{opacity:.7;margin:8px 0 32px}.desc{opacity:.75;line-height:1.5}
/* buttons */
button{border:none;border-radius:999px;padding:14px 28px;font-size:15px;cursor:pointer}
.primary{background:#fff;color:#0b1220}
/* chat */
.chat{display:flex;flex-direction:column;height:100%}.chat-log{flex:1;overflow:auto;margin-bottom:12px}.msg{padding:12px 16px;border-radius:16px;margin-bottom:10px;max-width:85%}.msg.user{background:#2563eb;align-self:flex-end}.msg.bot{background:rgba(255,255,255,.1)}.chat-input{display:flex;gap:8px}.chat-input input{flex:1;border-radius:999px;border:none;padding:12px 16px}
/* navigation bar */
.nav{height:72px;display:none;backdrop-filter:blur(16px);background:rgba(10,18,32,.85);border-top:1px solid rgba(255,255,255,.08)}
.nav button{flex:1;background:none;color:#fff;opacity:.6;font-size:12px}.nav button.active{opacity:1}.nav span{display:block;font-size:22px;margin-bottom:4px}
</style>
</head>

<body>
<div class="bg"></div>

<div class="app">
  <!-- login screen -->
  <section class="screen active" id="login">
    <div class="center">
      <div class="logo">AX</div>
      <div class="title">Aethel Axis</div>
      <div class="tagline">First, We Listen.</div>
      <div class="desc">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –º–æ—Ä—è–∫–æ–≤. –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</div>
      <button class="primary" id="loginBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á–µ—Ä–µ–∑ Telegram</button>
    </div>
  </section>

  <!-- home -->
  <section class="screen" id="home">
    <div class="center">
      <div class="title" id="hello">Hello.</div>
      <div class="desc">
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Aethel¬†Axis ‚Äî —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –∏ —É–º–Ω–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞ –¥–ª—è –º–æ—Ä—è–∫–æ–≤. –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–º–æ–≥–∞—Ç—å —Å –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ –∏ –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—É–¥–æ–≤—ã–º –º–∞–Ω—É–∞–ª–∞–º.
      </div>
    </div>
  </section>

  <!-- voice -->
  <section class="screen" id="voice">
    <div class="center">
      <div class="title">Voice</div>
      <div class="desc">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –∏ –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤. –î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TTS¬†/¬†STT –Ω–∞ backend.</div>
    </div>
  </section>

  <!-- chat -->
  <section class="screen" id="chat">
    <div class="chat">
      <div class="chat-log" id="chatLog"></div>
      <div class="chat-input">
        <input id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å‚Ä¶" />
        <button class="primary" id="sendBtn">‚û§</button>
      </div>
    </div>
  </section>

  <!-- manuals -->
  <section class="screen" id="manuals">
    <div class="center">
      <div class="title">Manuals</div>
      <div class="desc">
        –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—É–¥–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å PDF, DOCX –∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.<br><br>
        (–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.)
      </div>
    </div>
  </section>

  <!-- bottom navigation -->
  <nav class="nav" id="nav">
    <button data-go="home" class="active"><span>‚åÇ</span>Home</button>
    <button data-go="voice"><span>üéôÔ∏è</span>Voice</button>
    <button data-go="chat"><span>üí¨</span>Chat</button>
    <button data-go="manuals"><span>üìò</span>Manuals</button>
  </nav>
</div>

<script>
// –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ backend (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π –¥–æ–º–µ–Ω/–ø–æ—Ä—Ç)
const BACKEND = "https://acai-backend.onrender.com";

const screens = document.querySelectorAll(".screen");
const nav = document.getElementById("nav");
let conversationId = null;

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
function show(pageId) {
  screens.forEach(s => s.classList.remove("active"));
  document.getElementById(pageId).classList.add("active");
  document.querySelectorAll(".nav button").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.go === pageId);
  });
}

/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –Ω–∏–∂–Ω–∏–º –∫–Ω–æ–ø–∫–∞–º */
document.querySelectorAll(".nav button").forEach(btn => {
  btn.onclick = () => show(btn.dataset.go);
});

/* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è */
document.getElementById("loginBtn").onclick = () => {
  // –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ /login backend-–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram
  window.location.href = BACKEND + "/login";
};

/* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
async function checkAuth() {
  try {
    const r = await fetch(BACKEND + "/me/export", { credentials: "include" });
    const data = await r.json();
    if (data.ok && data.data) {
      const name = data.data.first_name || data.data.username || "Sailor";
      document.getElementById("hello").textContent = `Hello, ${name}.`;
      nav.style.display = "flex";
      show("home");
      return;
    }
  } catch (_) {}
  // –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äì –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ login
  show("login");
}
checkAuth();

/* –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º —á–∞—Ç-–∫–æ–Ω–≤–µ—Ä—Å–∞—Ü–∏—é */
async function ensureConversation() {
  if (conversationId) return;
  const res = await fetch(BACKEND + "/api/conversations", { credentials: "include" });
  const json = await res.json();
  if (json.items && json.items.length > 0) {
    conversationId = json.items[0].id;
  } else {
    const res2 = await fetch(BACKEND + "/api/conversations", { method: "POST", credentials: "include" });
    const json2 = await res2.json();
    conversationId = json2.id;
  }
}

/* –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç */
document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;
  input.value = "";
  const log = document.getElementById("chatLog");
  log.innerHTML += `<div class="msg user">${text}</div>`;
  log.scrollTop = log.scrollHeight;
  await ensureConversation();
  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ backend
  const res = await fetch(`${BACKEND}/api/chat/${conversationId}`, {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  });
  const json = await res.json();
  if (json.reply) {
    log.innerHTML += `<div class="msg bot">${json.reply}</div>`;
    log.scrollTop = log.scrollHeight;
  }
};
</script>
</body>
</html>
